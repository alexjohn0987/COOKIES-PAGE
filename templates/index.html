<!DOCTYPE html>
<html>
<head>
    <title>Facebook Commenter</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, textarea { width: 100%; padding: 8px; }
        textarea { height: 100px; }
        button { padding: 10px 15px; background: #4CAF50; color: white; border: none; cursor: pointer; }
        .task-status { margin-top: 20px; padding: 15px; background: #f5f5f5; }
    </style>
</head>
<body>
    <h1>Facebook Commenter</h1>
    
    <form id="commentForm">
        <div class="form-group">
            <label>Cookies (one per line):</label>
            <textarea name="cookies" required></textarea>
        </div>
        
        <div class="form-group">
            <label>Post URL:</label>
            <input type="text" name="post_url" required>
        </div>
        
        <div class="form-group">
            <label>Hater Name:</label>
            <input type="text" name="hater_name" required>
        </div>
        
        <div class="form-group">
            <label>Last Name:</label>
            <input type="text" name="last_name" required>
        </div>
        
        <div class="form-group">
            <label>Comments (one per line):</label>
            <textarea name="comments" required></textarea>
        </div>
        
        <div class="form-group">
            <label>Delay (seconds):</label>
            <input type="number" name="delay" value="10" min="5" required>
        </div>
        
        <button type="button" id="startBtn">Start Commenting</button>
        <button type="button" id="stopBtn" disabled>Stop</button>
    </form>
    
    <div id="taskInfo" class="task-status" style="display: none;">
        <h2>Task Status</h2>
        <p>Task ID: <span id="taskId"></span></p>
        <p>Status: <span id="taskStatus"></span></p>
        <p>Comments Sent: <span id="commentCount"></span></p>
        <p>Last Status: <span id="lastStatus"></span></p>
    </div>
    
    <div id="activeTasks">
        <h2>Active Tasks</h2>
        <div id="tasksList"></div>
    </div>

    <script>
        let currentTaskId = null;
        
        document.getElementById('startBtn').addEventListener('click', startTask);
        document.getElementById('stopBtn').addEventListener('click', stopTask);
        
        function startTask() {
            const formData = new FormData(document.getElementById('commentForm'));
            const data = Object.fromEntries(formData.entries());
            
            fetch('/start_task', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            })
            .then(res => res.json())
            .then(data => {
                if (data.status === 'success') {
                    currentTaskId = data.task_id;
                    document.getElementById('taskId').textContent = currentTaskId;
                    document.getElementById('taskInfo').style.display = 'block';
                    document.getElementById('stopBtn').disabled = false;
                    updateTaskStatus();
                } else {
                    alert('Error: ' + data.message);
                }
            });
        }
        
        function stopTask() {
            if (!currentTaskId) return;
            
            fetch(`/stop_task/${currentTaskId}`, { method: 'POST' })
            .then(res => res.json())
            .then(data => {
                if (data.status === 'success') {
                    document.getElementById('stopBtn').disabled = true;
                }
            });
        }
        
        function updateTaskStatus() {
            if (!currentTaskId) return;
            
            fetch(`/task_status/${currentTaskId}`)
            .then(res => res.json())
            .then(data => {
                if (data.status === 'success') {
                    document.getElementById('taskStatus').textContent = data.data.status;
                    document.getElementById('commentCount').textContent = data.data.comment_count;
                    document.getElementById('lastStatus').textContent = data.data.last_status;
                    
                    if (data.data.status === 'running') {
                        setTimeout(updateTaskStatus, 2000);
                    }
                }
            });
        }
        
        function updateActiveTasks() {
            fetch('/active_tasks')
            .then(res => res.json())
            .then(data => {
                const tasksList = document.getElementById('tasksList');
                tasksList.innerHTML = '';
                
                if (data.data && Object.keys(data.data).length > 0) {
                    for (const [taskId, task] of Object.entries(data.data)) {
                        const taskDiv = document.createElement('div');
                        taskDiv.innerHTML = `
                            <div style="border:1px solid #ddd; padding:10px; margin:5px 0;">
                                <h3>Task ${taskId}</h3>
                                <p>Status: ${task.status}</p>
                                <p>Comments: ${task.comment_count}</p>
                                <button onclick="stopSpecificTask('${taskId}')">Stop</button>
                            </div>
                        `;
                        tasksList.appendChild(taskDiv);
                    }
                }
            });
            
            setTimeout(updateActiveTasks, 3000);
        }
        
        window.stopSpecificTask = function(taskId) {
            fetch(`/stop_task/${taskId}`, { method: 'POST' });
        };
        
        // Initial load
        updateActiveTasks();
    </script>
</body>
</html>
